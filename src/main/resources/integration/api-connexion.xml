<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:int="http://www.springframework.org/schema/integration"
  xmlns:int-http="http://www.springframework.org/schema/integration/http"
  xmlns:int-stream="http://www.springframework.org/schema/integration/stream"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd
    http://www.springframework.org/schema/integration/http http://www.springframework.org/schema/integration/http/spring-integration-http.xsd
    http://www.springframework.org/schema/integration/stream http://www.springframework.org/schema/integration/stream/spring-integration-stream.xsd">

  <!-- Global Wiretap -->
  <int:wire-tap pattern="channel.*" channel="channel.consoleOut"/>
  <int-stream:stdout-channel-adapter id="channel.consoleOut" append-newline="true"/>

  <!-- Connexion Poller -->
  <int:inbound-channel-adapter channel="channel.connexion" expression="''">
    <!-- for batch processing -->
    <int:poller fixed-delay="1000"></int:poller>
  </int:inbound-channel-adapter>

  <!-- Connexion -->
  <int:chain input-channel="channel.connexion">
    <int:transformer ref="connexionPayload"/>
    <int-http:outbound-gateway
      url-expression="headers['url']"
      http-method="POST"
      reply-timeout="5000"
      transfer-cookies="true"
      expected-response-type="com.darva.sinapps.api.client.transverse.model.InlineResponse200">
    </int-http:outbound-gateway>
    <int:gateway request-channel="channel.partenaire"/>
  </int:chain>

  <!-- Partenaire -->
  <int:chain input-channel="channel.partenaire">
    <int:transformer ref="partenairePayload"/>
    <int-http:outbound-gateway
      url-expression="headers['url']"
      http-method="GET"
      reply-timeout="5000"
      transfer-cookies="true"
      expected-response-type="com.darva.sinapps.api.client.transverse.model.InlineResponse2001">
    </int-http:outbound-gateway>
    <int:gateway request-channel="channel.missions"/>
  </int:chain>

  <!-- Missions -->
  <int:chain input-channel="channel.missions">
    <int:transformer ref="missionsPayload"/>
    <int-http:outbound-gateway
      url-expression="headers['url']"
      http-method="GET"
      reply-timeout="5000"
      transfer-cookies="true"
      expected-response-type="com.darva.sinapps.api.client.transverse.model.InlineResponse2002">
    </int-http:outbound-gateway>
  </int:chain>

</beans>