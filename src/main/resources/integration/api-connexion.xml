<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:int="http://www.springframework.org/schema/integration"
  xmlns:int-http="http://www.springframework.org/schema/integration/http"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd
    http://www.springframework.org/schema/integration/http http://www.springframework.org/schema/integration/http/spring-integration-http.xsd">

  <!-- Connexion Poller -->
  <int:inbound-channel-adapter channel="channel.login" expression="''">
    <!-- for batch processing -->
    <int:poller fixed-delay="1000"></int:poller>
  </int:inbound-channel-adapter>

  <!-- Connexion -->
  <int:chain input-channel="channel.login">
    <int:transformer ref="connexionPayload"/>
    <int-http:outbound-gateway
      http-method="POST"
      url-expression="headers['url']"
      expected-response-type-expression="headers['response']"
      reply-timeout="5000"
      transfer-cookies="true">
    </int-http:outbound-gateway>
    <int:gateway request-channel="channel.partenaire"/>
  </int:chain>

  <!-- Partenaire -->
  <int:chain input-channel="channel.partenaire">
    <int:transformer ref="partenairePayload"/>
    <int-http:outbound-gateway
      reply-timeout="5000"
      url-expression="headers['url']"
      expected-response-type-expression="headers['response']"
      http-method="GET"
      transfer-cookies="true">
    </int-http:outbound-gateway>
    <int:gateway request-channel="channel.missions"/>
  </int:chain>

  <!-- Missions -->
  <int:chain input-channel="channel.missions">
    <int:transformer ref="missionsPayload"/>
    <int-http:outbound-gateway
      http-method="GET"
      url-expression="headers['url']"
      expected-response-type-expression="headers['response']"
      reply-timeout="5000"
      transfer-cookies="true">
    </int-http:outbound-gateway>
  </int:chain>

</beans>