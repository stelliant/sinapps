---
swagger: "2.0"
info:
  description: "Services d'API transverses à toutes les API Sinapps."
  version: "1"
  title: "Sinapps IRD Transverse v1"
  contact: {}
consumes:
- "application/json"
produces:
- "application/json"
security:
- Custom: []
paths:
  /api/login:
    post:
      tags:
      - "Connexion / Déconnexion"
      summary: "Connexion"
      description: "C'est le point d'entrée de l'API SINAPPS. \n\nPermet de se connecter\
        \ à l'API pour ensuite naviguer de ressources en ressources en suivant les\
        \ liens proposés."
      consumes: []
      parameters:
      - name: "body"
        in: "body"
        required: true
        schema:
          type: "object"
          required:
          - "login"
          - "password"
          properties:
            login:
              type: "string"
            password:
              type: "string"
      responses:
        200:
          description: "Lorsque la connexion à l'API est réussie, vous recevez en\
            \ réponse un flux Json contenant des informations sur l'utilisateur connecté\
            \ ainsi qu'un cookie nommé \"PLAY_SESSION\" qu'il est indispensable de\
            \ transmettre avec chacune des autres requêtes vers le serveur SINAPPS."
          schema:
            required:
            - "href"
            - "properties"
            type: "object"
            properties:
              href:
                type: "string"
              properties:
                required:
                - "id"
                - "login"
                - "personne"
                - "pertenaireId"
                type: "object"
                properties:
                  id:
                    type: "string"
                  pertenaireId:
                    type: "string"
                  login:
                    type: "string"
                  personne:
                    $ref: "#/definitions/Personne"
                  roles:
                    $ref: "#/definitions/Roles"
              links:
                $ref: "#/definitions/Links"
          headers:
            Set-Cookie:
              type: "string"
              description: "Récupérer le cookie \"PLAY_SESSION\" transmis par l'API\
                \ SINAPPS pour pouvoir le retransmettre avec chacune de vos requê\
                tes."
      security: []
  /api/logout:
    put:
      tags:
      - "Connexion / Déconnexion"
      summary: "Déconnexion"
      description: "Lorsque vos traitements utilisant l'API SINAPPS sont terminés,\
        \ il est conseillé de se déconnecter de l'API pour libérer la session."
      parameters: []
      responses:
        200:
          description: "Status 200"
  /consulter partenaire:
    get:
      tags:
      - "Partenaires"
      summary: "Rechercher le partenaire, tous domaines confondus."
      parameters:
      - name: "fullText"
        in: "query"
        required: false
        type: "string"
      - name: "typePrestation"
        in: "query"
        required: false
        type: "string"
      - name: "mandant"
        in: "query"
        required: false
        type: "string"
      - name: "prestataire"
        in: "query"
        required: false
        type: "string"
      - name: "etatMission"
        in: "query"
        required: false
        type: "string"
      - name: "prestationCloturee"
        in: "query"
        required: false
        type: "boolean"
      - name: "departementRisque"
        in: "query"
        required: false
        type: "string"
      - name: "dateDebutMissionnement"
        in: "query"
        required: false
        type: "string"
      - name: "dateFinMissionnement"
        in: "query"
        required: false
        type: "string"
        format: "date"
      responses:
        200:
          description: "Status 200"
          schema:
            required:
            - "href"
            - "properties"
            type: "object"
            properties:
              href:
                type: "string"
              properties:
                $ref: "#/definitions/Partenaire"
              links:
                $ref: "#/definitions/Links"
  /consulter abstractMissions:
    get:
      tags:
      - "Partenaires"
      summary: "Rechercher les missions du partenaire, tous domaines confondus."
      parameters:
      - name: "fullText"
        in: "query"
        required: false
        type: "string"
      - name: "typePrestation"
        in: "query"
        required: false
        type: "string"
      - name: "mandant"
        in: "query"
        required: false
        type: "string"
      - name: "prestataire"
        in: "query"
        required: false
        type: "string"
      - name: "etatMission"
        in: "query"
        required: false
        type: "string"
      - name: "prestationCloturee"
        in: "query"
        required: false
        type: "boolean"
      - name: "departementRisque"
        in: "query"
        required: false
        type: "string"
      - name: "dateDebutMissionnement"
        in: "query"
        required: false
        type: "string"
      - name: "dateFinMissionnement"
        in: "query"
        required: false
        type: "string"
        format: "date"
      responses:
        200:
          description: "Status 200"
          schema:
            required:
            - "href"
            - "items"
            - "properties"
            type: "object"
            properties:
              href:
                type: "string"
              properties:
                $ref: "#/definitions/ListeProperties"
              items:
                type: "array"
                items:
                  required:
                  - "href"
                  - "properties"
                  type: "object"
                  properties:
                    href:
                      type: "string"
                    properties:
                      $ref: "#/definitions/MissionGenerique"
                    links:
                      $ref: "#/definitions/Links"
              links:
                $ref: "#/definitions/Links"
  /lienVersUneListeDeRessources:
    get:
      tags:
      - "Généralités sur les consultations de ressources"
      summary: "Consultation d'une liste de ressources (ex: events, missions, ...)"
      description: "Certains liens présents sur une ressource permettent d'obtenir\
        \ une liste de ressources. Par exemple, la liste des événements, la liste\
        \ des commandes ou encore une liste de ressources métiers liées.\nCes listes\
        \ respectent toujours la même structure.\n\n\n**Attention** : Vous ne devez\
        \ pas forger vous même ces liens. Il sont récupérés lors de la consultation\
        \ des ressources parmi les \"links\". Par exemple, pour obtenir la liste des\
        \ rendez-vous associés à une mission, il faut récupérer le lien \"rendezVous\"\
        \ sur la mission concernée. \n\n## Note importante sur les critères de recherches\n\
        Ces services de consultation d'une liste de ressources sont en fait des services\
        \ de recherches qui dans certains cas peuvent prendre en compte des critè\
        res pour filtrer les instances recherchées. Les critères de recherches possibles\
        \ varient selon le type des ressources recherchées. Pour les documenter de\
        \ façon synthétique, dans la suite de cette documentation, pour chaque ressource,\
        \ un tableau des critères de recherche disponibles est présenté. Il vous est\
        \ alors possible d'ajouter ces critères sous la forme de paramètres de requê\
        te (\"query parameters\") à la fin de l'url récupérée sur la ressource mè\
        re.\n\n\n**Par exemple**, vous souhaitez retrouver les missions dont les ré\
        férences du sinistre sont \"dsf654d2\". Pour cela, vous devez récupérer le\
        \ lien sur les missions du partenaire auquel correspond votre utilisateur\
        \ et ajouter à la fin de l'url le paramètre \"&reference=dsf654d2\" sans rien\
        \ modifier au reste de l'url.\n\n## Cas des listes d'événements\nVous allez\
        \ fréquemment parcourir la liste des événements générés par les actions des\
        \ autes utilisateurs pour vous-même pouvoir entreprendre les actions qui vous\
        \ incombent. Le moyen le plus simple de traiter tous ces événements est de\
        \ parcourir ceux disponibles à partir de la ressource \"Partenaire\" correspondant\
        \ au compte utilisateur avec lequel vous êtes connecté à l'API SINAPPS. Il\
        \ faut savoir que SINAPPS ne conserve par le fait que vous ayez consulté ou\
        \ non un événement. Donc, pour éviter de parcourir tous les événements à chaque\
        \ fois, il vous appartient de conserver l'ID du dernier événement que vous\
        \ avez traité. Vous pourrez ainsi facilement reprendre la consultation à partir\
        \ de l'événement suivant.\n\n\nPour vous aidez, sur les service de consultation\
        \ d'une liste d'événements, les filtres suivants sont disponibles :\n* **since**\
        \ : retourne la liste des événements qui suivent l'événement dont l'identifiant\
        \ est indiqué dans \"since\".\n* **maxEvents** : nombre maximum d'événements\
        \ à consulter.\n* **eventNames** : liste des types d'événements que vous souhaitez\
        \ consulter. Vous pouvez indiquer ici le nom des types d'événements que vous\
        \ souhaitez traiter pour éviter d'obtenir des événements qui ne vous inté\
        ressent pas."
      parameters: []
      responses:
        200:
          description: "Status 200"
          schema:
            $ref: "#/definitions/ListeRessources"
  /lienVersUneRessourceDeTypeEvenement:
    get:
      tags:
      - "Généralités sur les consultations de ressources"
      summary: "Consultation d'un événement (ex; MissionCreee, RendezVousPris, ...)"
      description: "**Attention** : Vous ne devez pas forger vous même ces liens.\
        \ La consultation d'une ressource **événement** se fait à partir d'un lien\
        \ obtenu sur une autre ressource. \n\nUn événement est constitué d'une liste\
        \ de sous-événements."
      parameters: []
      responses:
        200:
          description: "Status 200"
          schema:
            required:
            - "href"
            - "items"
            - "properties"
            type: "object"
            properties:
              href:
                type: "string"
                description: "Url de l'événement"
              properties:
                required:
                - "id"
                type: "object"
                properties:
                  id:
                    type: "string"
                    description: "ID de l'évenement"
              items:
                type: "array"
                items:
                  required:
                  - "href"
                  type: "object"
                  properties:
                    href:
                      type: "string"
                      description: "Url du sous-événement"
                    properties:
                      required:
                      - "name"
                      - "ontologyId"
                      - "resourceType"
                      - "userId"
                      type: "object"
                      properties:
                        ontologyId:
                          type: "string"
                          description: "Code de l'ontologie à l'origine de l'événement"
                        resourceType:
                          type: "string"
                          description: "Type de la ressource sur lequel s'applique\
                            \ l'événement"
                        name:
                          type: "string"
                          description: "Nom de l'événement\n\nLa liste des noms d'é\
                            vénements possible dépend de la ressource auquel il s'applique."
                        userId:
                          type: "string"
                          description: "ID de l'utilisateur à l'origine de l'événement"
  /lienVersUneRessourceMetier:
    get:
      tags:
      - "Généralités sur les consultations de ressources"
      summary: "Consultation d'une ressource métier (mission , rapport, facture, ...)"
      description: "**Attention** : Vous ne devez pas forger vous même ces liens.\
        \ La consultation d'une **ressource métier** se fait à partir d'un lien obtenu\
        \ sur une autre ressource. \n\nQuel que soit son type, elle retourne un flux\
        \ structuré de la même façon. Seul le contenu de la partie “properties” varie\
        \ selon le type de la ressource.\n\nDans la suite de la documentation, la\
        \ structure de l’objet “properties” spécifique à la ressource sera décrit\
        \ pour chacune des ressources métiers."
      parameters: []
      responses:
        200:
          description: "Status 200"
          schema:
            required:
            - "href"
            - "properties"
            type: "object"
            properties:
              href:
                type: "string"
                description: "Url de la ressource"
              properties:
                type: "object"
                description: "Propriétés de la ressources.\n\nElles dépendent du type\
                  \ de la ressource."
              links:
                $ref: "#/definitions/Links"
  /lienVersUneRessourceDeTypeCommande:
    get:
      tags:
      - "Généralités sur les consultations de ressources"
      summary: "Consultation de la documentation d'une commande (deposerMission, prendreRendezVous,\
        \ ...)"
      description: "**Attention** : Vous ne devez pas forger vous même ces liens.\
        \ La consultation d’une **commande** se fait à partir d’un lien obtenu sur\
        \ une autre ressource.\n\nQuel que soit son type, elle retourne un flux structuré\
        \ de la même façon. Seul le contenu de la partie “properties” varie selon\
        \ la commande consultée.\n\nCe service permet d'obtenir la documentation de\
        \ la commande (quelle est la structure du flux attendu, quelle est celle du\
        \ flux retourné, quelles sont les valeurs possibles, ...)"
      parameters: []
      responses:
        200:
          description: "Status 200"
          schema:
            required:
            - "actions"
            - "href"
            - "properties"
            type: "object"
            properties:
              href:
                type: "string"
                description: "Url de la commande"
              properties:
                required:
                - "description"
                - "label"
                - "name"
                type: "object"
                properties:
                  name:
                    type: "string"
                    description: "Code de la commande"
                  description:
                    type: "string"
                  label:
                    type: "string"
                    description: "Nom de la commande"
              actions:
                type: "array"
                items:
                  required:
                  - "href"
                  - "method"
                  - "rel"
                  type: "object"
                  properties:
                    rel:
                      type: "string"
                      description: "Type de l'action sur cette commande"
                      enum:
                      - "submit (exécuter réellement la commande)"
                      - "test (lancer la commande sans mise à jour du système pour\
                        \ test)"
                    method:
                      type: "string"
                      description: "Méthode HTTP à utiliser"
                    href:
                      type: "string"
                      description: "Url de la commande"
                    format:
                      type: "object"
                      description: "Description du flux métier attendu pour l'exé\
                        cution de la commande"
securityDefinitions:
  Custom:
    type: "apiKey"
    name: "Cookie"
    in: "header"
definitions:
  Adresse:
    type: "object"
    properties:
      Adresse1:
        type: "string"
      codePostal:
        type: "string"
      localite:
        type: "string"
  CodeAssureur:
    type: "object"
    properties:
      codeSociete:
        type: "string"
      codeActivite:
        type: "string"
  Erreur:
    type: "object"
    required:
    - "errorType"
    - "status"
    - "userMessage"
    properties:
      status:
        type: "string"
      errorType:
        type: "string"
      userMessage:
        type: "string"
      devMessage:
        type: "string"
      formsError:
        type: "string"
    description: "En cas d'erreur, le flux retourné respecte toujours le format suivant."
  Item:
    type: "object"
    description: "Elément d'une liste de ressources.  Chaque élément représente une\
      \ ressource. Le flux caractérisant l'élément dépend du type de l'élément (une\
      \ commande, un événement, une ressource métier X ou Y)"
    example: "Elément d'une liste de ressources.  Chaque élément représente une ressource.\
      \ Le flux caractérisant l'élément dépend du type de l'élément (une commande,\
      \ un événement, une ressource métier X ou Y)"
  Links:
    type: "array"
    items:
      required:
      - "href"
      - "rel"
      type: "object"
      properties:
        rel:
          type: "string"
        href:
          type: "string"
  ListeProperties:
    type: "object"
    required:
    - "firstPage"
    - "lastPage"
    - "nbElementPerPage"
    - "noPage"
    - "totalNumberOfElements"
    properties:
      totalNumberOfElements:
        type: "number"
      noPage:
        type: "number"
      nbElementPerPage:
        type: "number"
      firstPage:
        type: "string"
      lastPage:
        type: "string"
  ListeRessources:
    type: "object"
    required:
    - "href"
    - "items"
    - "links"
    properties:
      href:
        type: "string"
      properties:
        $ref: "#/definitions/ListeProperties"
      items:
        type: "array"
        items:
          $ref: "#/definitions/Item"
      links:
        $ref: "#/definitions/Links"
      #filters:
      #  type: "array"
      #  description: "Liste des filtres qu'il est possible d'appliquer sur le service\
      #    \ de recherche. Ces filtres sont à transmettre au service en query parameter."
      #  items:
      #    type: "object"
  MissionGenerique:
    type: "object"
    required:
    - "assure"
    - "assureurId"
    - "cause"
    - "cloture"
    - "dateCreation"
    - "dateDeMissionnement"
    - "difficulteBloquante"
    - "difficulteNonBloquante"
    - "etapeMission"
    - "finDeMissionneDemandee"
    - "id"
    - "lieu"
    - "nature"
    - "numero"
    - "pourcentageAvancement"
    - "prestataireId"
    - "referenceSinistre"
    - "typeMission"
    properties:
      assureurId:
        type: "string"
        description: "ID de l'assureur dans Sinapps"
      lieu:
        type: "string"
      difficulteBloquante:
        type: "boolean"
      typeMission:
        required:
        - "label"
        - "name"
        type: "object"
        properties:
          name:
            type: "string"
            description: "Code du type de mission"
            enum:
            - "RenDirecte"
            - "UH"
            - "Expertise"
            - "..."
          label:
            type: "string"
            description: "Libellé du type de la mission"
      pourcentageAvancement:
        type: "number"
      prestataireId:
        type: "string"
      numero:
        type: "string"
        description: "Numéro de la mission chez l'assureur"
      dateDeMissionnement:
        type: "string"
        format: "date-time"
      difficulteNonBloquante:
        type: "boolean"
      etapeMission:
        required:
        - "label"
        - "name"
        type: "object"
        properties:
          name:
            type: "string"
          label:
            type: "string"
      cause:
        required:
        - "label"
        - "name"
        type: "object"
        properties:
          name:
            type: "string"
          label:
            type: "string"
      cloture:
        type: "boolean"
      nature:
        required:
        - "label"
        - "name"
        type: "object"
        properties:
          name:
            type: "string"
          label:
            type: "string"
      finDeMissionneDemandee:
        type: "boolean"
      referenceSinistre:
        type: "string"
      assure:
        type: "string"
        description: "Nom de l'assuré"
      id:
        type: "string"
        description: "ID de la mission dans Sinapps"
      dateCreation:
        type: "string"
        format: "date-time"
    description: "Description d'une mission IRD, tous domaines confondus. Les informations\
      \ spécifiques au domaine de la mission (REN, Expertise, Urgence Habitation)\
      \ ne sont pas indiqués ici."
  Partenaire:
    type: "object"
    required:
    #- "href"
    #- "properties"
    #properties:
    #  href:
    #    type: "string"
    #  properties:
    #    required:
    - "nom"
    - "numeroClient"
    #    - "typePartenaire"
    #    type: "object"
    properties:
      numeroClient:
        type: "integer"
      nom:
        type: "string"
      typePartenaire:
            #type: "string"
            #enum:
            #- "Assureur"
            #- "Darva"
            #- "Reparateur"
        type: "object"
        properties:
          name:
            type: "string"
          label:
            type: "string"
      adresse:
        $ref: "#/definitions/Adresse"
      codeAssureur:
        $ref: "#/definitions/CodeAssureur"
      id:
        type: "string"
      version:
        type: "integer"
      dateDeCreation:
        type: "string"
        format: "date-time"
      dateDeDerniereModification:
        type: "string"
        format: "date-time"
  Personne:
    type: "object"
    properties:
      nom:
        type: "string"
      prenom:
        type: "string"
      coordonnees:
        type: "object"
        properties:
          telPersonnel:
            type: "string"
          email:
            type: "string"
  Roles:
    type: "array"
    items:
      required:
      - "label"
      - "names"
      type: "object"
      properties:
        names:
          type: "string"
        label:
          type: "string"
